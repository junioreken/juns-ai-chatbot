<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JUNâ€™S AI</title>
  <link rel="stylesheet" href="/chatbot-style.css" />
</head>
<body>
  <div id="juns-chatbox">
    <div class="chat-messages" id="chat">
      <div class="message ai">Hi! Choose a language / Choisissez une langue: ğŸ‡¬ğŸ‡§ English | ğŸ‡«ğŸ‡· FranÃ§ais</div>
    </div>
    <div id="typing"></div>
    <div id="chat-input">
      <input id="msgInput" placeholder="Type your message..." />
      <button onclick="sendMessage()">Send</button>
    </div>
  </div>

  <script>
    let lang = '';
    let name = '';
    let email = '';

    function addMessage(content, sender = 'user') {
      const div = document.createElement('div');
      div.className = 'message ' + sender;
      div.innerText = content;
      document.getElementById('chat').appendChild(div);
      document.getElementById('chat').scrollTop = 99999;
    }

    async function sendMessage() {
      const msg = document.getElementById('msgInput').value;
      if (!msg) return;
      addMessage(msg, 'user');
      document.getElementById('msgInput').value = '';
      document.getElementById('typing').innerText = "JUNâ€™S AI is typing...";

      const res = await fetch('/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: msg, lang, name, email })
      });
      const data = await res.json();
      addMessage(data.reply, 'ai');
      document.getElementById('typing').innerText = "";

      if (!lang && msg.toLowerCase().includes('fr')) lang = 'fr';
      if (!lang && msg.toLowerCase().includes('en')) lang = 'en';

      if (!name && lang) {
        setTimeout(() => {
          addMessage(lang === 'fr' ? "Quel est votre prÃ©nom ?" : "What's your name?", 'ai');
        }, 1000);
      }

      if (!email && name) {
        setTimeout(() => {
          addMessage(lang === 'fr' ? "Quel est votre email ?" : "What's your email?", 'ai');
        }, 1000);
      }
    }
  </script>
</body>
</html>
